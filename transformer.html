<!DOCTYPE html>
<html>
<head>
  <title>Transformer Inspection</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="data.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f4f4;
    }

    .topbar {
      background: #0c0c0c;
      padding: 20px 0 25px 0;
      text-align: center;
      box-shadow: 0 3px 8px rgba(0,0,0,.45);
    }
    .topbar img {
      width: 120px;
      filter: drop-shadow(0px 4px 6px rgba(0,0,0,.55));
    }
    .title {
      margin-top: 10px;
      font-size: 26px;
      font-weight: bold;
      background: linear-gradient(90deg,#ffd65a,#ffb300);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .card {
      background: #fff;
      padding: 20px;
      max-width: 800px;
      margin: 20px auto;
      border-radius: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,.15);
    }

    label {
      display:block;
      margin-top:12px;
      font-weight:bold;
    }

    input, select, textarea {
      width:100%;
      padding:10px;
      margin-top:3px;
      border:1px solid #ccc;
      border-radius:7px;
      font-size:15px;
    }

    textarea { height:80px; }

    .btn {
      width:100%;
      padding:12px;
      margin-top:12px;
      border:none;
      border-radius:8px;
      font-size:16px;
      font-weight:bold;
      cursor:pointer;
      color:white;
    }
    .btn-blue { background:#007bff; }
    .btn-red { background:#c40000; }

    #formCard { display:none; }

    .section-title {
      margin-top:18px;
      font-weight:bold;
      font-size:17px;
      border-left:4px solid #ffb300;
      padding-left:10px;
    }

    img.preview {
      width: 100%;
      display:none;
      margin-top:10px;
      border:2px solid #444;
      border-radius:10px;
    }
  </style>
</head>

<body>

<div class="topbar">
  <img src="logo.png">
  <div class="title">Transformer Inspection</div>
</div>

<!-- LOGIN BOX -->
<div class="card" id="loginCard">
  <h2>Electrician Login</h2>
  <input type="password" id="loginKey" placeholder="Enter Electrician Password">
  <button class="btn btn-red" onclick="login()">Login</button>
  <div id="loginError" style="color:red;margin-top:10px;"></div>
</div>

<!-- ðŸ”§ ADDED: TRANSFORMER INFO CARD -->
<div class="card" id="transformerInfo" style="display:none;">
  <h3>Transformer Details</h3>
  <p><b>ID:</b> <span id="info_id"></span></p>
  <p><b>Capacity:</b> <span id="info_kva"></span> kVA</p>
  <p><b>Location:</b> <span id="info_location"></span></p>
</div>

<!-- FORM -->
<div class="card" id="formCard">

  <h2>Transformer Inspection</h2>

  <label>Date & Time</label>
  <input type="datetime-local" id="tr_datetime">

  <label>Electrician Name</label>
  <input type="text" id="tr_name">

  <!-- REST OF FORM UNCHANGED -->
  <!-- â€¦ your existing form code continues exactly same â€¦ -->

  <button class="btn btn-blue" onclick="submitTransformer()">Submit Inspection</button>
</div>

<script>
const ELECTRICIAN_KEY = "9999";

if (sessionStorage.getItem("electricianLogged") === "true") {
  showForm();
}

function login() {
  const key = document.getElementById("loginKey").value.trim();
  if (key === ELECTRICIAN_KEY) {
    sessionStorage.setItem("electricianLogged", "true");
    showForm();
  } else {
    document.getElementById("loginError").innerText = "Incorrect password!";
  }
}

function showForm() {
  document.getElementById("loginCard").style.display = "none";
  document.getElementById("formCard").style.display = "block";

  const now = new Date();
  document.getElementById("tr_datetime").value = now.toISOString().slice(0,16);

  loadTransformerInfo();   // ðŸ”§ ADDED
  loadQuestions();
}

/* GET TRANSFORMER ID */
const params = new URLSearchParams(window.location.search);
const trId = params.get("id") || "TR-001";

/* ðŸ”§ ADDED: LOAD TRANSFORMER META */
function loadTransformerInfo() {
  loadTransformer(trId, t => {
    if (!t) return;
    document.getElementById("info_id").innerText = trId;
    document.getElementById("info_kva").innerText = t.rating || "";
    document.getElementById("info_location").innerText = t.location || "";
    document.getElementById("transformerInfo").style.display = "block";
  });
}
</script>

</body>
</html>
