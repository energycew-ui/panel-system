<!DOCTYPE html>
<html>
<head>
  <title>Electrical Panel Access</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="data.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f4f4;
    }

    /* Premium Header */
    .topbar {
      background: #0c0c0c;
      padding: 22px 0 26px 0;
      text-align: center;
      box-shadow: 0 3px 8px rgba(0,0,0,0.45);
    }
    .topbar img {
      width: 120px;
      filter: drop-shadow(0px 4px 6px rgba(0,0,0,0.6));
    }
    .title {
      margin-top: 12px;
      font-size: 26px;
      font-weight: bold;
      background: linear-gradient(90deg,#ffd65a,#ffb300);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .card {
      background: #fff;
      padding: 22px;
      max-width: 900px;
      margin: 20px auto;
      border-radius: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .btn {
      padding: 14px;
      font-size: 17px;
      font-weight: bold;
      width: 100%;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin-top: 12px;
    }
    .menu-btn {
      padding: 12px;
      border-radius: 10px;
      background: #fafafa;
      border: 2px solid #ccc;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 14px;
      margin-top: 12px;
    }
    .menu-btn:hover {
      border-color: #ffb300;
      background: #fff4cc;
    }
    .icon {
      font-size: 28px;
    }

    /* Visitor Info Layout */
    .warning-bar {
      background: #c40000;
      color: #fff;
      padding: 12px;
      text-align: center;
      font-size: 18px;
      font-weight: bold;
      border-radius: 8px;
      margin-bottom: 15px;
      letter-spacing: 0.5px;
    }

    .info-row {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .info-left {
      flex: 1 1 300px;
    }
    .info-right {
      flex: 1 1 260px;
      text-align: center;
    }
    .info-right img {
      width: 100%;
      border-radius: 10px;
      border: 2px solid #333;
    }

    label {
      display: block;
      margin-top: 8px;
      font-weight: bold;
    }

    /* Electrician Menu */
    .btn-blue { background:#007bff; color:#fff; }
    .btn-gold { background:#ffb300; color:#000; }
    .btn-red { background:#c40000; color:#fff; }
    .btn-dark { background:#333; color:#fff; }
  </style>
</head>

<body>

<!-- HEADER -->
<div class="topbar">
  <img src="logo.png">
  <div class="title">Electrical Panel Access</div>
</div>

<!-- ACCESS SELECTION -->
<div class="card" id="accessSelect">
  <h2 style="text-align:center;">Choose Access</h2>

  <div class="menu-btn" onclick="selectVisitor()">
    <div class="icon">üë§</div> Visitor ‚Äì View Panel Details Only
  </div>

  <div class="menu-btn" onclick="selectElectrician()">
    <div class="icon">üõ†Ô∏è</div> Electrician ‚Äì Authorized Access
  </div>
</div>

<!-- VISITOR VIEW -->
<div class="card" id="visitorCard" style="display:none;">
  <div class="warning-bar">‚ö†Ô∏è DB INFORMATION ‚Äì DO NOT TOUCH ‚ö†Ô∏è</div>

  <div class="info-row">

    <div class="info-left">
      <label>DB Number:</label>
      <div id="v_db"></div>

      <label>Voltage:</label>
      <div id="v_volt"></div>

      <label>Main Breaker:</label>
      <div id="v_breaker"></div>

      <label>Cable Size:</label>
      <div id="v_cable"></div>

      <label>Earth Status:</label>
      <div id="v_earth"></div>

      <label>Location:</label>
      <div id="v_location"></div>

      <label>Purpose:</label>
      <div id="v_purpose"></div>

      <label>Circuits:</label>
      <ul id="v_circuits"></ul>

      <label>Extra Info:</label>
      <div id="v_extra"></div>
    </div>

    <div class="info-right">
      <img id="v_image" style="display:none;">
    </div>

  </div>
</div>

<!-- ELECTRICIAN LOGIN -->
<div class="card" id="electricianLogin" style="display:none;">
  <h2>Electrician Login</h2>
  <input id="elecKey" type="password" placeholder="Enter Electrician Password" style="width:100%;padding:12px;font-size:17px;">
  <button class="btn btn-red" onclick="loginElec()">Login</button>
  <div id="loginError" style="color:red;margin-top:10px;"></div>
</div>

<!-- ELECTRICIAN MENU -->
<div class="card" id="electricianMenu" style="display:none;">
  <h2>Electrician Menu</h2>

  <button class="btn btn-blue" onclick="openModifyDB()">üîß Modify DB</button>
  <button class="btn btn-blue" onclick="openInspection()">üìã DB Inspection</button>
  <button class="btn btn-red" onclick="openFault()">‚ö° Fault Report</button>
  <button class="btn btn-gold" onclick="openTransformer()">üîå Transformer Inspection</button>
  <button class="btn btn-dark" onclick="openLux()">üí° LUX Monitoring</button>
</div>

<script>
/* -----------------------------
   GET DB ID
----------------------------- */
const urlParams = new URLSearchParams(window.location.search);
const dbId = urlParams.get("id");

/* -----------------------------
   LOAD PANEL FROM FIREBASE
----------------------------- */
function loadPanelData() {
  loadPanelFromFirebase(dbId, p => {
    if (!p) return alert("Panel not found.");

    document.getElementById("v_db").innerText = p.dbNumber || dbId;
    document.getElementById("v_volt").innerText = p.voltage || "";
    document.getElementById("v_breaker").innerText = p.mainBreaker || "";
    document.getElementById("v_cable").innerText = p.cableSize || "";
    document.getElementById("v_earth").innerText = p.earthStatus || "";
    document.getElementById("v_location").innerText = p.location || "";
    document.getElementById("v_purpose").innerText = p.purpose || "";

    /* Circuits */
    const cList = document.getElementById("v_circuits");
    cList.innerHTML = "";
    if (p.circuits) {
      p.circuits.forEach(c => {
        const li = document.createElement("li");
        li.textContent = `${c.name} ‚Äî ${c.breaker} ‚Äî ${c.load}`;
        cList.appendChild(li);
      });
    }

    /* Extra Fields */
    const eDiv = document.getElementById("v_extra");
    eDiv.innerHTML = "";
    if (p.extraAnswers) {
      Object.entries(p.extraAnswers).forEach(([key,val]) => {
        const d = document.createElement("div");
        d.textContent = `${key}: ${val}`;
        eDiv.appendChild(d);
      });
    }

    /* Image */
    if (p.image) {
      const img = document.getElementById("v_image");
      img.src = p.image;
      img.style.display = "block";
    }
  });
}

/* -----------------------------
   VISITOR MODE
----------------------------- */
function selectVisitor() {
  document.getElementById("accessSelect").style.display = "none";
  document.getElementById("visitorCard").style.display = "block";
  loadPanelData();
}

/* -----------------------------
   ELECTRICIAN MODE
----------------------------- */
const ELEC_KEY = "9999";

function selectElectrician() {
  document.getElementById("accessSelect").style.display = "none";

  if (sessionStorage.getItem("electricianLogged") === "true") {
    showElecMenu();
  } else {
    document.getElementById("electricianLogin").style.display = "block";
  }
}

function loginElec() {
  const key = document.getElementById("elecKey").value;
  if (key === ELEC_KEY) {
    sessionStorage.setItem("electricianLogged", "true");
    showElecMenu();
  } else {
    document.getElementById("loginError").innerText = "Incorrect password!";
  }
}

function showElecMenu() {
  document.getElementById("electricianLogin").style.display = "none";
  document.getElementById("electricianMenu").style.display = "block";
}

/* -----------------------------
   BUTTON ACTIONS
----------------------------- */
function openModifyDB() {
  window.location.href = "panel.html?id=" + dbId + "#modify";
}
function openInspection() {
  window.location.href = "electrician.html?id=" + dbId;
}
function openFault() {
  window.location.href = "fault.html?id=" + dbId;
}
function openTransformer() {
  window.location.href = "transformer.html?id=" + dbId;
}
function openLux() {
  window.location.href = "lux.html?id=" + dbId;
}

</script>

</body>
</html>
