<!DOCTYPE html>
<html>
<head>
  <title>Fault Report â€“ Print View</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background: white;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    .logo {
      width: 120px;
      margin-bottom: 10px;
    }
    .title {
      font-size: 32px;
      font-weight: 800;
      background: linear-gradient(90deg, #ffd65a, #ffb300);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .subtitle {
      color: #444;
      margin-top: -6px;
      font-size: 15px;
    }

    /* Sections */
    h2 {
      background: #111;
      color: #ffc800;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 18px;
      margin-top: 35px;
    }

    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    th {
      background: #333;
      color: white;
      padding: 8px;
      text-align: left;
      font-size: 14px;
    }
    td {
      border: 1px solid #ccc;
      padding: 8px;
      vertical-align: top;
      font-size: 14px;
    }

    /* Photos */
    .photo {
      width: 260px;
      border: 1px solid #888;
      border-radius: 6px;
      margin: 10px 8px 0 0;
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <!-- Your Firebase config -->
  <script src="data.js?v=5"></script>
</head>

<body>

<!-- Header Block -->
<div class="header">
  <img src="logo.png" class="logo">
  <div class="title">Electrical Fault Report</div>
  <div class="subtitle">Chenab Engineering Works</div>
</div>

<!-- Section: Basic Info -->
<h2>Basic Information</h2>
<table id="infoTable">
  <tr><th>DB Number</th><td id="dbId"></td></tr>
  <tr><th>Electrician</th><td id="electrician"></td></tr>
  <tr><th>Date / Time</th><td id="date"></td></tr>
  <tr><th>Fault Type</th><td id="faultType"></td></tr>
</table>

<!-- Section: Description -->
<h2>Fault Description</h2>
<table>
  <tr><th>Description</th><td id="desc"></td></tr>
  <tr><th>Production Loss</th><td id="prodLoss"></td></tr>
  <tr><th>Downtime</th><td id="downtime"></td></tr>
</table>

<!-- Section: Additional Questions -->
<h2>Additional Details</h2>
<table id="extraTable"></table>

<!-- Section: Photos -->
<h2>Attached Photos</h2>
<div id="photos"></div>

<script>
function qs(n) {
  return new URLSearchParams(window.location.search).get(n);
}

const dbId = qs("db");
const recordKey = qs("id");

function loadFault() {
  firebase.database()
    .ref(`faults/${dbId}/${recordKey}`)
    .once("value")
    .then(snap => {
      const r = snap.val();
      if (!r) {
        alert("Fault record not found.");
        return;
      }

      document.getElementById("dbId").textContent = dbId;
      document.getElementById("electrician").textContent = r.electricianName || "";
      document.getElementById("date").textContent =
        r.timestamp ? new Date(r.timestamp).toLocaleString() : "";

      document.getElementById("faultType").textContent = r.faultType || "";
      document.getElementById("desc").textContent = r.description || "";

      // Production loss
      let lossText = r.productionLoss || "No";
      if (r.productionLossDesc) lossText += " - " + r.productionLossDesc;
      document.getElementById("prodLoss").textContent = lossText;

      // Downtime
      let dt = "";
      if (r.startTime) dt += "Start: " + r.startTime + "  ";
      if (r.endTime) dt += "End: " + r.endTime + "  ";
      if (r.downtimeMinutes != null)
        dt += ` | Total: ${r.downtimeMinutes} min`;
      document.getElementById("downtime").textContent = dt || "N/A";

      // Extra Questions
      const extraTable = document.getElementById("extraTable");
      extraTable.innerHTML = "";
      if (r.extraAnswers) {
        Object.entries(r.extraAnswers).forEach(([qid,val]) => {
          extraTable.innerHTML += `
            <tr><th>${qid}</th><td>${val}</td></tr>
          `;
        });
      }

      // Photos
      const ph = document.getElementById("photos");
      ph.innerHTML = "";
      ["photo1","photo2","photo3"].forEach(p => {
        if (r[p]) {
          ph.innerHTML += `<img src="${r[p]}" class="photo">`;
        }
      });
    });
}

window.onload = loadFault;
</script>

</body>
</html>
